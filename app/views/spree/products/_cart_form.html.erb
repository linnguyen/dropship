<%= form_for :order, url: populate_orders_path do |f| %>
  <div class="row" id="inside-product-cart-form" data-hook="inside_product_cart_form" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
    <% if @product.variants_and_option_values(current_currency).any? %>
      <div id="product-variants" class="col-md-12">
        <div class="product-options">
          <% if @product.has_variants? %>
            <% index = 0 %>
            <% @product.grouped_option_values.each do |type, values| %>
              <div id="<%= dom_id(type) %>" class="variant-options index-<%= index %>">
                <ul class="size-option <%= type.name.downcase %>">
                  <li><span class="text-uppercase"><%= type.presentation %>:</span></li>
                  <% values.sort_by(&:position).each do |value| %>
                    <li id= <%= value.id %>><a href="#"><%= value.presentation %></a></li>
                  <% end %>
                </ul>
                <div class="alert alert-warning" style="display: none">
                  Please select a <%= type.name.downcase %>
                </div>
              </div>
              <% index += 1 %>
            <% end %>
            <%= hidden_field_tag "variant_id", '', id: "hidden-variant-id" %>
          <% end %>
        </div>
      </div>
    <% else %>
      <%= hidden_field_tag "variant_id", @product.master.id %>
    <% end %>

    <% if @product.price_in(current_currency) && !@product.price.nil? %>
      <div data-hook="product_price" class="col-md-8">
        <!-- Remove Spree price here-->
        <% if @product.can_supply? %>
          <div class="add-to-cart">
            <br/>
            <div class="input-group">
              <div class="qty-input">
                <span class="text-uppercase">QTY: </span>
                <%= number_field_tag :quantity, 1, class: 'input', min: 1 %>
              </div>
              <%= button_tag class: 'primary-btn add-to-cart', id: 'add-to-cart-button', type: :submit do %>
                <i class="fa fa-shopping-cart"></i>
                <%= Spree.t(:add_to_cart) %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div id="product-price">
        <br/>
        <div>
           <span class="price selling" itemprop="price">
             <%= Spree.t('product_not_available_in_this_currency') %>
           </span>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<%= javascript_tag do %>
  $(document).ready(function(){
  $('span#<%= s_or_b %>country .select2').on('change', function() {
     update_state('<%= s_or_b %>'); });
  });
<% end %>

<!-- This js only apply for size and color. if another value type in the future will custom later -->
<script type="text/javascript">

    var option_value_ids = []
    var sizeId = -1
    var colorId = -1

    <% if @product.grouped_option_values.size == 1 %>
    <% if @product.grouped_option_values.first[0].name.downcase == 'size' %>
    // When we click on the li
    $('.size > li').click(function () {
            // If this isn't already active
            if (!$(this).hasClass("active")) {
                // Remove the class from anything that is active
                $(".size > li.active").removeClass("active");
                // And make this active
                $(this).addClass("active");

                // get and add option_value_id to option_value_ids array
                sizeId = $(this).attr('id')

                // check if array option_value_ids will
                if (sizeId != -1) {
                    option_value_ids.push(sizeId)
                    $.ajax({
                        url: "<%= get_variant_path(@product) %>?ids=" + option_value_ids.join(','),
                        method: "post",
                        success: function (data) {
                            option_value_ids = []
                            Spree.showVariantImages(data.image_ids)
                            document.getElementById('hidden-variant-id').value = data.variant_id;
                            alert(document.getElementById('hidden-variant-id').value)
                        }
                    });
                }
            }
        }
    );
    <% end %>
    <% if @product.grouped_option_values.first[0].name.downcase == 'color' %>
    // When we click on the li
    $('.color > li').click(function () {
            // If this isn't already active
            if (!$(this).hasClass("active")) {
                // Remove the class from anything that is active
                $(".color > li.active").removeClass("active");
                // And make this active
                $(this).addClass("active");

                // get and add option_value_id to option_value_ids array
                sizeId = $(this).attr('id')

                // check if array option_value_ids will
                if (colorId != -1) {
                    option_value_ids.push(colorId)
                    $.ajax({
                        url: "<%= get_variant_path(@product) %>?ids=" + option_value_ids.join(','),
                        method: "post",
                        success: function (data) {
                            option_value_ids = []
                            Spree.showVariantImages(data.image_ids)
                            document.getElementById('hidden-variant-id').value = data.variant_id;
                            alert(document.getElementById('hidden-variant-id').value)
                        }
                    });
                }
            }
        }
    );
    <% end %>
    <% else %>  // greater than 1, mean include size and color!!

    $('.size > li').click(function () {
            // If this isn't already active
            if (!$(this).hasClass("active")) {
                // Remove the class from anything that is active
                $(".size > li.active").removeClass("active");
                // And make this active
                $(this).addClass("active");

                // get and add option_value_id to option_value_ids array
                sizeId = $(this).attr('id')

                if (sizeId != -1 && colorId != -1) {
                    option_value_ids.push(sizeId)
                    option_value_ids.push(colorId)
                    $.ajax({
                        url: "<%= get_variant_path(@product) %>?ids=" + option_value_ids.join(','),
                        method: "post",
                        success: function (data) {
                            option_value_ids = []
                            Spree.showVariantImages(data.image_ids)
                            document.getElementById('hidden-variant-id').value = data.variant_id;
                            alert(document.getElementById('hidden-variant-id').value)
                        }
                    });
                }
            }
        }
    );

    $('.color > li').click(function () {
            // If this isn't already active
            if (!$(this).hasClass("active")) {
                // Remove the class from anything that is active
                $(".color > li.active").removeClass("active");
                // And make this active
                $(this).addClass("active");

                // get and add option_value_id to option_value_ids array
                colorId = $(this).attr('id')

                if (sizeId != -1 && colorId != -1) {
                    option_value_ids.push(sizeId)
                    option_value_ids.push(colorId)
                    $.ajax({
                        url: "<%= get_variant_path(@product) %>?ids=" + option_value_ids.join(','),
                        method: "post",
                        success: function (data) {
                            option_value_ids = []
                            Spree.showVariantImages(data.image_ids)
                            document.getElementById('hidden-variant-id').value = data.variant_id;
                            alert(document.getElementById('hidden-variant-id').value)
                        }
                    });
                }
            }
        }
    );

    <% end %>

</script>

<!-- reference: https://stackoverflow.com/questions/34898575/spree-dropdown-boxes-for-variant-option-values -->
<!-- it working wrong https://github.com/citrus/spree_variant_options -->

<!-- for variant image size select http://www.rootspot.com/stackoverflow/amazon/ -->