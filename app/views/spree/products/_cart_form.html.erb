<%= form_for :order, url: populate_orders_path do |f| %>
  <div class="row" id="inside-product-cart-form" data-hook="inside_product_cart_form" itemprop="offers" itemscope itemtype="https://schema.org/Offer">
    <% if @product.variants_and_option_values(current_currency).any? %>
      <div id="product-variants" class="col-md-6">
        <% if @product.has_variants? %>
          <% index = 0 %>
          <% @product.grouped_option_values.each do |type, values| %>
            <div id="<%= dom_id(type) %>" class="variant-options index-<%= index %>">
              <h6><%= type.presentation %></h6>
              <ul class="size-option <%= type.name.downcase %>">
                <% values.sort_by(&:position).each do |value| %>
                  <li id= <%= value.id %>><a href="#"><%= value.presentation %></a></li>
                <% end %>
              </ul>
            </div>
            <% index += 1 %>
          <% end %>
          <%= hidden_field_tag "variant_id", "18129292" %>
        <% end %>
      </div>
    <% else %>
      <%= hidden_field_tag "variant_id", @product.master.id %>
    <% end %>

    <% if @product.price_in(current_currency) && !@product.price.nil? %>
      <div data-hook="product_price" class="col-md-8">
        <!-- Remove Spree price here-->
        <% if @product.can_supply? %>
          <div class="add-to-cart">
            <br/>
            <div class="input-group">
              <div class="qty-input">
                <span class="text-uppercase">QTY: </span>
                <%= number_field_tag :quantity, 1, class: 'input', min: 1 %>
              </div>
              <%= button_tag class: 'primary-btn add-to-cart', id: 'add-to-cart-button', type: :submit do %>
                <i class="fa fa-shopping-cart"></i>
                <%= Spree.t(:add_to_cart) %>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div id="product-price">
        <br/>
        <div>
           <span class="price selling" itemprop="price">
             <%= Spree.t('product_not_available_in_this_currency') %>
           </span>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<!-- This js only apply for size and color. if another value type in the future will custom later -->
<script type="text/javascript">

    var option_value_ids = []
    var sizeId = -1
    var colorId = -1

    <% if @product.grouped_option_values.size == 1 %>

    // When we click on the li
    $('.size-option > li').click(function () {
            // If this isn't already active
            if (!$(this).hasClass("active")) {
                // Remove the class from anything that is active
                $(".<%= type.presentation.downcase %> > li.active").removeClass("active");
                // And make this active
                $(this).addClass("active");

                // get and add option_value_id to option_value_ids array
                sizeId = $(this).attr('id')

                // check if array option_value_ids will
                if (sizeId != -1 && colorId != -1) {
                    option_value_ids.push(sizeId)
                    option_value_ids.push(colorId)
                    $.ajax({
                        url: "<%= get_variant_path(@product) %>?ids=" + option_value_ids.join(','),
                        method: "post",
                        success: function (data) {
                            alert(data.toString())
                        }
                    });
                }
            }
        }
    );
    <% else %>  // greater than 1, mean include size and color!!

    $('.size > li').click(function () {
            // If this isn't already active
            if (!$(this).hasClass("active")) {
                // Remove the class from anything that is active
                $(".size > li.active").removeClass("active");
                // And make this active
                $(this).addClass("active");

                // get and add option_value_id to option_value_ids array
                sizeId = $(this).attr('id')
                alert("size " + sizeId)

                if (sizeId != -1 && colorId != -1) {
                    option_value_ids.push(sizeId)
                    option_value_ids.push(colorId)
                    $.ajax({
                        url: "<%= get_variant_path(@product) %>?ids=" + option_value_ids.join(','),
                        method: "post",
                        success: function (data) {
                            console.log(data)
                            option_value_ids = []
                            Spree.showVariantImages(data)
                        }
                    });
                }
            }
        }
    );

    $('.color > li').click(function () {
            // If this isn't already active
            if (!$(this).hasClass("active")) {
                // Remove the class from anything that is active
                $(".color > li.active").removeClass("active");
                // And make this active
                $(this).addClass("active");

                // get and add option_value_id to option_value_ids array
                colorId = $(this).attr('id')
                alert("color " + colorId)

                if (sizeId != -1 && colorId != -1) {
                    option_value_ids.push(sizeId)
                    option_value_ids.push(colorId)
                    $.ajax({
                        url: "<%= get_variant_path(@product) %>?ids=" + option_value_ids.join(','),
                        method: "post",
                        success: function (data) {
                            console.log(data)
                            option_value_ids = []
                            Spree.showVariantImages(data)
                        }
                    });
                }
            }
        }
    );

    <% end %>

</script>

<!-- reference: https://stackoverflow.com/questions/34898575/spree-dropdown-boxes-for-variant-option-values -->
<!-- it working wrong https://github.com/citrus/spree_variant_options -->

<!-- for variant image size select http://www.rootspot.com/stackoverflow/amazon/ -->